spockPics = {"spock_beam_in_4":"spock/4.png","spock_beam_in_5":"spock/5.png","spock_beam_in_6":"spock/6.png","spock_beam_in_7":"spock/7.png","spock_beam_in_8":"spock/8.png","spock_beam_in_9":"spock/9.png","spock_beam_in_10":"spock/10.png","spock_beam_in_11":"spock/11.png","spock_beam_in_12":"spock/12.png","spock_beam_in_13":"spock/13.png","spock_beam_in_14":"spock/14.png","spock_beam_in_15":"spock/15.png","spock_beam_in_16":"spock/16.png","spock_beam_in_17":"spock/17.png","spock_beam_in_18":"spock/18.png","spock_beam_in_19":"spock/19.png","spock_beam_in_20":"spock/20.png","spock_beam_in_21":"spock/21.png","spock_beam_in_22":"spock/22.png","spock_beam_in_23":"spock/23.png","spock_beam_in_24":"spock/24.png","spock_beam_in_25":"spock/25.png","spock_beam_in_26":"spock/26.png","spock_beam_in_27":"spock/27.png","spock_beam_in_28":"spock/28.png","spock_beam_in_29":"spock/29.png","spock_beam_in_30":"spock/30.png","spock_beam_in_31":"spock/31.png","spock_beam_in_32":"spock/32.png","spock_beam_in_33":"spock/33.png","spock_beam_in_34":"spock/34.png","spock_beam_in_35":"spock/35.png","spock_beam_in_36":"spock/36.png","spock_beam_in_37":"spock/37.png","spock_beam_in_38":"spock/38.png","spock_beam_in_39":"spock/39.png","spock_beam_in_40":"spock/40.png","spock_beam_in_41":"spock/41.png","spock_beam_in_42":"spock/42.png","spock_beam_in_43":"spock/43.png","spock_beam_in_44":"spock/44.png","spock_beam_in_45":"spock/45.png","spock_beam_in_46":"spock/46.png","spock_beam_in_47":"spock/47.png","spock_beam_in_48":"spock/48.png","spock_beam_in_49":"spock/49.png","spock_beam_in_50":"spock/50.png","spock_beam_in_51":"spock/51.png","spock_beam_in_52":"spock/52.png","spock_beam_in_53":"spock/53.png","spock_beam_in_54":"spock/54.png","spock_beam_in_55":"spock/55.png","spock_beam_in_56":"spock/56.png","spock_beam_in_57":"spock/57.png","spock_beam_in_58":"spock/58.png","spock_beam_in_59":"spock/59.png","spock_beam_in_60":"spock/60.png","spock_beam_in_61":"spock/61.png","spock_beam_in_62":"spock/62.png","spock_beam_in_63":"spock/63.png","spock_beam_in_64":"spock/64.png","spock_beam_in_65":"spock/65.png","spock_beam_in_66":"spock/66.png","spock_beam_in_67":"spock/67.png","spock_beam_in_68":"spock/68.png","spock_beam_in_69":"spock/69.png","spock_beam_in_70":"spock/70.png","spock_beam_in_71":"spock/71.png","spock_beam_in_72":"spock/72.png","spock_beam_in_73":"spock/73.png","spock_beam_in_74":"spock/74.png","spock_beam_in_75":"spock/75.png","spock_beam_in_76":"spock/76.png","spock_beam_in_77":"spock/77.png","spock_beam_in_78":"spock/78.png","spock_beam_in_79":"spock/79.png","spock_beam_in_80":"spock/80.png","spock_beam_in_81":"spock/81.png","spock_beam_in_82":"spock/82.png","spock_beam_in_83":"spock/83.png","spock_beam_in_84":"spock/84.png","spock_beam_in_85":"spock/85.png","spock_beam_in_86":"spock/86.png","spock_beam_in_87":"spock/87.png","spock_beam_in_88":"spock/88.png","spock_beam_in_89":"spock/89.png","spock_beam_in_90":"spock/90.png","spock_beam_in_91":"spock/91.png","spock_beam_in_92":"spock/92.png","spock_beam_in_93":"spock/93.png","spock_beam_in_94":"spock/94.png","spock_beam_in_95":"spock/95.png","spock_beam_in_96":"spock/96.png","spock_beam_in_97":"spock/97.png","spock_beam_in_98":"spock/98.png","spock_beam_in_99":"spock/99.png","spock_beam_in_100":"spock/100.png","spock_beam_in_101":"spock/101.png","spock_beam_in_102":"spock/102.png","spock_beam_in_103":"spock/103.png","spock_beam_in_104":"spock/104.png","spock_beam_in_105":"spock/105.png","spock_beam_in_106":"spock/106.png","spock_beam_in_107":"spock/107.png","spock_beam_in_108":"spock/108.png","spock_beam_in_109":"spock/109.png","spock_beam_in_110":"spock/110.png","spock_beam_in_111":"spock/111.png","spock_beam_in_112":"spock/112.png","spock_turn_left_1":"spock/115.png","spock_turn_left_2":"spock/116.png","spock_start_walk_1":"spock/118.png","spock_start_walk_2":"spock/119.png","spock_start_walk_3":"spock/120.png","spock_walk_1":"spock/121.png","spock_walk_2":"spock/122.png","spock_walk_3":"spock/123.png","spock_walk_4":"spock/124.png","spock_walk_5":"spock/125.png","spock_walk_6":"spock/126.png","spock_walk_7":"spock/127.png","spock_walk_8":"spock/128.png","spock_walk_9":"spock/129.png","spock_end_walk_1":"spock/130.png","spock_end_walk_2":"spock/131.png","spock_end_walk_3":"spock/110.png","spock_com_1":"spock/133.png","spock_com_2":"spock/134.png","spock_com_3":"spock/135.png","spock_com_4":"spock/136.png","spock_com_5":"spock/137.png","spock_com_6":"spock/112.png","spock_tri_start_1":"spock/139.png","spock_tri_start_2":"spock/140.png","spock_tri_start_3":"spock/139.png","spock_tri_start_4":"spock/141.png","spock_tri_1":"spock/142.png","spock_tri_2":"spock/143.png","spock_tri_adjust_1":"spock/144.png","spock_tri_adjust_2":"spock/145.png","spock_tri_adjust_3":"spock/144.png","spock_tri_end_1":"spock/141.png","spock_tri_end_2":"spock/139.png","spock_tri_end_3":"spock/140.png","spock_tri_end_4":"spock/139.png","spock_tri_end_5":"spock/112.png","spock_phaser_draw_1":"spock/150.png","spock_phaser_draw_2":"spock/151.png","spock_phaser_draw_3":"spock/152.png","spock_phaser_draw_4":"spock/152.png","spock_phaser_holster_1":"spock/152.png","spock_phaser_holster_2":"spock/151.png","spock_phaser_holster_3":"spock/150.png","spock_phaser_holster_4":"spock/112.png","spock_phaser_crouch_fire_1":"spock/153.png","spock_phaser_crouch_fire_2":"spock/154.png","spock_phaser_crouch_fire_3":"spock/153.png","spock_phaser_standing_fire_1":"spock/157.png","spock_phaser_standing_fire_2":"spock/158.png","spock_phaser_standing_fire_3":"spock/157.png"};
function loadImages(){
    for(var imgId in spockPics){
        // var i = document.createElement('img');
        // i.src="https://aitongoldman.github.io/null-lock/img/"+spockPics[imgId];
        // i.id=imgId;
        // //i.style="visibility:hidden;position:absolute;";
        // document.body.appendChild(i);
        $("body").append("<img style='position:absolute;visibility:hidden' id='"+imgId+"' src='https://aitongoldman.github.io/null-lock/img/"+spockPics[imgId]+"'>");
    }    
    $("body").append('<div id="phaser_beam" style="position:absolute;visibility:hidden;background-color:green;transform:rotate(10deg);">')
    //$("body").append('<style>#phaser_beam {background-color:green;transform:rotate(10deg);}</style>');
}

animationHistory = []


var MAX_META_ANIMATIONS = 1;
var MIN_META_ANIMATIONS = 2;

var META_ANIMATION_BEAM_IN = 0;
var META_ANIMATION_BEAM_OUT = 0;
var META_ANIMATION_WALK_LEFT = 0;
var META_ANIMATION_COM_LEFT = 1;

var ANIMATION_BEAM_IN = 0;
var ANIMATION_BEAM_OUT = 1;
var ANIMATION_WALK_LEFT_START = 2;
var ANIMATION_WALK_LEFT = 3;
var ANIMATION_WALK_END = 4;
var ANIMATION_COM_LEFT = 5;
var ANIMATION_TURN_LEFT= 6;
var ANIMATION_COM_END_LEFT = 7;
var ANIMATION_TRI_START_LEFT = 8;
var ANIMATION_TRI_LEFT = 9;
var ANIMATION_TRI_ADJUST_LEFT = 10;
var ANIMATION_TRI_END_LEFT = 11;
var ANIMATION_PHASER_START_LEFT=12;
var ANIMATION_PHASER_CROUCH_LEFT=13;
var ANIMATION_PHASER_STANDING_LEFT=14;
var ANIMATION_PHASER_HOLSTER_LEFT=15;
var ANIMATION_PHASER_END_LEFT=16;
var ANIMATION_RETURN_TO_STANDING=17;
var animationStarts=[ANIMATION_BEAM_IN,ANIMATION_WALK_LEFT_START,ANIMATION_COM_LEFT,ANIMATION_TRI_START_LEFT,ANIMATION_PHASER_START_LEFT];
var animationsLeft=[...animationStarts];

const deepCopyFunction = (inObject) => {
    let outObject, value, key

    if (typeof inObject !== "object" || inObject === null) {
        return inObject // Return the value if inObject is not an object
    }

    // Create an array or object to hold the values
    outObject = Array.isArray(inObject) ? [] : {}

    for (key in inObject) {
        value = inObject[key]

        // Recursively (deep) copy for nested objects, including arrays
        outObject[key] = deepCopyFunction(value)
    }

    return outObject
}

function dumpImgElementsJson(){
    var imgDumpJson = {};
    $("img").each((i,e)=>{
        //console.log($(e).attr("src")+" "+$(e).attr("id"))
        imgDumpJson[$(e).attr("id")]=$(e).attr("src");
    })
    $("#dump").html(JSON.stringify(imgDumpJson));

}

function create_animation_frame(animation, frame_num, duration, img_layer, delta_x, delta_y) {
    animation.list_of_animations_for_run[frame_num] = {
        duration: duration,
        img_layer: img_layer,
        delta_x: delta_x,
        delta_y: delta_y
    }
}

function create_animation_object(max_frame) {
    var animation_obj = {
        cur_frame: 0,
        max_frame: max_frame,
        time_on_cur_frame: 0,
        list_of_animations_for_run: [],
        num_repeats:0
    };
    return animation_obj;
}

function create_spock(animations,rules) {
    return {
        prev_frame_div:undefined,
        cur_frame_div:undefined,
        animations:animations,
        current_animation: ANIMATION_BEAM_IN,
        current_animation_object: deepCopyFunction(animations[ANIMATION_BEAM_IN]),
        x: 400,
        y: 400,
        last_three_animations:[],
        timeStampOfLastFrame:0,
        rules:rules
    }
}

function getRandomInt(max) {
     return Math.floor(Math.random() * Math.floor(max));
}

function choose_next_animation(spock){            
    if(spock.x<-25){
        spock.x = getRandomInt(500);
        spock.y = getRandomInt(500);
        spock.current_animation=ANIMATION_BEAM_IN
        spock.current_animation_object=deepCopyFunction(spock.animations[ANIMATION_BEAM_IN])
        return;
    }
    if(spock.current_animation_object.num_repeats>0){
        spock.current_animation_object.num_repeats=spock.current_animation_object.num_repeats-1;
        spock.current_animation_object.cur_frame=0;
        return;
    }
    if(spock.rules[spock.current_animation]){
        new_animation_range = spock.rules[spock.current_animation].length;              
        var new_animation_list = spock.rules[spock.current_animation];
        animationsLeft.findIndex((e)=>{

        })
        
        new_animation_index = getRandomInt(new_animation_list.length);
        new_animation = new_animation_list[new_animation_index].new_animation;  
        num_repeats = getRandomInt(new_animation_list[new_animation_index].num_repeats);
        console.log("NUM REPEATS WILL BE "+num_repeats)
        spock.last_three_animations.push(spock.current_animation);
        if(spock.last_three_animations.length == 5){
            spock.last_three_animations = spock.last_three_animations.slice(1)
        }
        spock.current_animation=new_animation
        spock.current_animation_object=deepCopyFunction(spock.animations[new_animation])
        spock.current_animation_object.num_repeats=num_repeats;
        new_animation_list[new_animation_index].spock_init(spock);
        return
    }
    
    spock.current_animation = undefined
}

function generic_frame_advance(animation_object){

}

function animation_loop(spock,proceed){
    // create function for each animation_sequence
    // generic function will just run through the frames
    // for different objects with different durations, need universal clock and each object needs to figure out how long since the last frame
    var diffTime = new Date().getTime() - spock.timeStampOfLastFrame;
    var duration =  spock.current_animation_object.list_of_animations_for_run[spock.current_animation_object.cur_frame].duration;

    //console.log(diffTime.toString()+" "+duration.toString());
    if(spock.current_animation == ANIMATION_PHASER_END_LEFT){
       //console.log(spock.current_animation_object.cur_frame);
    }    
    if(diffTime > duration){
        spock.timeStampOfLastFrame = new Date().getTime();
    } else {
       setTimeout(()=>{                
           animation_loop(spock,true)},25)           
       return;
    }
    if(spock.current_animation == ANIMATION_PHASER_CROUCH_LEFT){
        if(spock.current_animation_object.cur_frame==0){
            place_phaser_beam(spock.x,spock.y)
        } else {
            $("#phaser_beam").css("visibility","hidden")
        }
    } 
             
    var done_with_animation=false;
    if(spock.current_animation_object.cur_frame+1>=spock.current_animation_object.max_frame){
        done_with_animation=true;
    }
    spock.prev_frame_div =  $("#"+spock.current_animation_object.list_of_animations_for_run[spock.current_animation_object.cur_frame].img_layer)

    if(done_with_animation!=true){
        spock.current_animation_object.cur_frame=spock.current_animation_object.cur_frame+1
    }

    if(done_with_animation){
        choose_next_animation(spock);
        if(spock.current_animation==undefined){
            return;
        }
    }
    spock.cur_frame_div =  $("#"+spock.current_animation_object.list_of_animations_for_run[spock.current_animation_object.cur_frame].img_layer)
    spock.x = spock.x + spock.current_animation_object.list_of_animations_for_run[spock.current_animation_object.cur_frame].delta_x
    spock.y = spock.y + spock.current_animation_object.list_of_animations_for_run[spock.current_animation_object.cur_frame].delta_y           
    // var duration =  spock.current_animation_object.list_of_animations_for_run[spock.current_animation_object.cur_frame].duration;
    $(spock.prev_frame_div).css("visibility","hidden");
    $(spock.cur_frame_div).css("top",spock.y);            
    $(spock.cur_frame_div).css("left",spock.x);
    $(spock.cur_frame_div).css("visibility","visible");
    // spock.timeStampOfLastFrame = new Date().getTime();
    //setTimeout(()=>{                
    //    animation_loop(spock,true)},duration)
    setTimeout(()=>{                
       animation_loop(spock,true)},25)            
}


function build_rule(next_animation,num_repeats,spock_init){
    return {
        new_animation:next_animation,
        spock_init:spock_init,
        num_repeats:num_repeats
    }
}
function slope(a, b) {
    if (a[0] == b[0]) {
        return null;
    }

    return (b[1] - a[1]) / (b[0] - a[0]);
}


function intercept(point, slope) {
    if (slope === null) {
     // vertical line
        return point[0];
    }

    return point[1] - slope * point[0];
}
function calc_phaser_collision(left,top){
    var width = left;
    var sinSide = Math.sin((85*Math.PI)/180)
    var result = (width/sinSide) * Math.sin((5*Math.PI)/180)
    var sinSide2 = Math.sin((90*Math.PI)/180)
    var result2 = (width/sinSide2) * Math.sin((80*Math.PI)/180)
    var phaser_tip_top_location = top + 17;
    // var phaser_tip_left_location = left  + 6;
    //var phaser_tip_top_location = top;
    var phaser_tip_left_location = left - 1;
    var end_of_phaser_line_top = phaser_tip_top_location-result;
    var end_of_phaser_line_left = phaser_tip_left_location-result2;                       
    console.log("end of phaser line",end_of_phaser_line_left+" "+end_of_phaser_line_top);
    var A = [end_of_phaser_line_left, end_of_phaser_line_top-32];
    var B = [phaser_tip_left_location, phaser_tip_top_location];


    var m = slope(A, B);
    var b = intercept(A, m);

    var coordinates = [];
    for (var x = A[0]; x <= B[0]; x++) {
        var y = m * x + b;
        coordinates.push([x, y]);
        var elementsHit=document.elementsFromPoint(x,y);
        if(elementsHit.length>0 ){                    
            for(var element of elementsHit){
                if(element.localName!="body" && element.localName!="html"){
                    if($(element).hasClass("phaserpulse")==false){
                        console.log($(element).hasClass("phaserpulse"));
                        var phaserLength = Math.abs($(element).offset().left-phaser_tip_left_location) - ($(element).width()/4)
                        $(element).addClass("animated phaserpulse")
                        return Math.floor(phaserLength);
                    }                           
                }
            }
            //console.log("INTERSECTION WITH",elementsHit)                                   
        }
        //$("body").append("<div style='position:absolute;left:"+Math.floor(x)+"px;top:"+Math.floor(y)+"px;height:1px;width:1px;background-color:red'></div>");
    
    }
    //document.elementsFromPoint()
    return left;
}

function place_phaser_beam( left, top ){
    if($("#phaser_beam").css("visibility")=="visible"){
        console.log("beam already there")
        return;
    }
    var width = calc_phaser_collision(left,top);
    $("#phaser_beam").css("visibility","visible");
    $("#phaser_beam").css("width",width.toString()+"px");
    var sinSide = Math.sin((85*Math.PI)/180)
    var result = (width/sinSide) * Math.sin((5*Math.PI)/180)
    var sinSide2 = Math.sin((90*Math.PI)/180)
    var result2 = (width/sinSide2) * Math.sin((80*Math.PI)/180)
    //console.log(result2);
    //var phaser_tip_top_location = 398 + 17;
    var phaser_tip_top_location = top + 17;
    var phaser_tip_left_location = left  + 6;
    // var phaser_tip_left_location = 362 + 6;
    $("#phaser_beam").css("height","2px");
    // $("#phaser_beam").css("top",(398+8).toString()+"px");
    // $("#phaser_beam").css("left",(362-94).toString()+"px");      
    $("#phaser_beam").css("top",(phaser_tip_top_location-result).toString()+"px");
    $("#phaser_beam").css("left",(phaser_tip_left_location-result2).toString()+"px");            

}

$(document).ready(function () {
    loadImages();
    var beam_in = create_animation_object(109);
    var beam_out = create_animation_object(109);
    var turn_left = create_animation_object(2);
    var walk_left_start = create_animation_object(3);
    var walk_left = create_animation_object(7);
    var walk_left_end = create_animation_object(3);
    var com_left = create_animation_object(5)
    var com_left_end = create_animation_object(6)
    var animations = [];

    animations[ANIMATION_BEAM_IN] = beam_in;
    animations[ANIMATION_BEAM_OUT] = beam_out;

    animations[ANIMATION_TURN_LEFT] = turn_left;
    animations[ANIMATION_WALK_LEFT_START] = walk_left_start;
    animations[ANIMATION_WALK_LEFT] = walk_left;
    animations[ANIMATION_WALK_END] = walk_left_end;
    animations[ANIMATION_COM_LEFT] = com_left;
    animations[ANIMATION_COM_END_LEFT] = com_left_end;
    animations[ANIMATION_TRI_START_LEFT] = create_animation_object(4)
    animations[ANIMATION_TRI_END_LEFT] = create_animation_object(5)
    animations[ANIMATION_TRI_LEFT] = create_animation_object(2)
    animations[ANIMATION_TRI_ADJUST_LEFT] = create_animation_object(3)
    animations[ANIMATION_PHASER_START_LEFT] = create_animation_object(3)
    animations[ANIMATION_PHASER_END_LEFT] = create_animation_object(4)

    animations[ANIMATION_PHASER_CROUCH_LEFT] = create_animation_object(3)
    animations[ANIMATION_PHASER_STANDING_LEFT] = create_animation_object(3)
    animations[ANIMATION_PHASER_HOLSTER_LEFT] = create_animation_object(4)
    animations[ANIMATION_RETURN_TO_STANDING] = create_animation_object(2)
    var animation_frame = 0;
    for (x = 4; x < 112; x++) {
        create_animation_frame(beam_in, animation_frame, 10, "spock_beam_in_" + x, 0,0);
        animation_frame = animation_frame + 1;
    }
    create_animation_frame(beam_in, animation_frame, 1000, "spock_beam_in_112", 0,0);
    animation_frame = 0;
    for (x = 112; x >= 4; x--) {
        create_animation_frame(beam_out, animation_frame, 10, "spock_beam_in_" + x, 0,0);
        animation_frame = animation_frame + 1;
    }

    animation_frame = 0;
    for (x = 1; x < 3; x++) {
        create_animation_frame(turn_left, animation_frame, 100, "spock_turn_left_" + x, 0,0);
        animation_frame = animation_frame + 1;
    }
    
    create_animation_frame(animations[ANIMATION_RETURN_TO_STANDING], 0, 100, "spock_turn_left_2", 0,0);
    create_animation_frame(animations[ANIMATION_RETURN_TO_STANDING], 1, 100, "spock_turn_left_1", 0,0);
    

    animation_frame = 0;
    walk_animation_offsets = [];          
    walk_animation_offsets=[-15,-7,0,-1,-5,-5,-10]
    for (x = 1; x < 8; x++) {
        create_animation_frame(walk_left, animation_frame, 100, "spock_walk_" + x, walk_animation_offsets[animation_frame],0);
        animation_frame = animation_frame + 1;
    }
    


    create_animation_frame(walk_left_start, 0, 100, "spock_start_walk_1", 0,0);
    create_animation_frame(walk_left_start, 1, 100, "spock_start_walk_2", -15,0);
    create_animation_frame(walk_left_start, 2, 100, "spock_start_walk_3", -10,0);
    create_animation_frame(walk_left_end, 0, 100, "spock_end_walk_1", -15,0);
    create_animation_frame(walk_left_end, 1, 100, "spock_end_walk_2", -10,0);
    create_animation_frame(walk_left_end, 2, 2000, "spock_end_walk_3", 5,0);   
    
    animation_frame=0;
    animation_offsets=[-6,6,0,0,-7];
    animation_offsets_y=[0,0,0,0,-1];
    for (x = 1; x < 6; x++) {
        create_animation_frame(com_left, animation_frame, 150, "spock_com_" + x, animation_offsets[animation_frame],animation_offsets_y[animation_frame]);
        animation_frame = animation_frame + 1;
    }
    com_left.list_of_animations_for_run[4].duration=1000;
    animation_frame=0;
    animation_offsets=[0,6,0,0,-6];
    animation_offsets_y=[0,1,0,0,0];
    for (x = 5; x >= 1; x--) {
        create_animation_frame(com_left_end, animation_frame, 150, "spock_com_" + x, animation_offsets[animation_frame],animation_offsets_y[animation_frame]);
        animation_frame = animation_frame + 1;
    }
    create_animation_frame(com_left_end, animation_frame, 150, "spock_com_6", 6,0);
    com_left_end.list_of_animations_for_run[5].duration=3000;

    animation_offsets=[-16,0,0,0,0];
    animation_offsets_y=[0,0,0,0,0];
    animation_frame=0;
    for (x = 1; x < 5; x++) {
        create_animation_frame(animations[ANIMATION_TRI_START_LEFT], animation_frame, 150, "spock_tri_start_" + x, animation_offsets[animation_frame],animation_offsets_y[animation_frame]);
        animation_frame = animation_frame + 1;
    }

    animation_offsets=[0,0,0,0,0];
    animation_offsets_y=[0,0,0,0,0];
    animation_frame=0;
    for (x = 1; x < 3; x++) {
        create_animation_frame(animations[ANIMATION_TRI_LEFT], animation_frame, 1150, "spock_tri_" + x, animation_offsets[animation_frame],animation_offsets_y[animation_frame]);
        animation_frame = animation_frame + 1;
    }

    animation_offsets=[0,0,0,0,0];
    animation_offsets_y=[0,0,0,0,0];
    animation_frame=0;
    for (x = 1; x < 4; x++) {
        create_animation_frame(animations[ANIMATION_TRI_ADJUST_LEFT], animation_frame, 150, "spock_tri_adjust_" + x, animation_offsets[animation_frame],animation_offsets_y[animation_frame]);
        animation_frame = animation_frame + 1;
    }
    animations[ANIMATION_TRI_ADJUST_LEFT].list_of_animations_for_run[1].duration=1000;

    animation_offsets=[0,0,0,0,15];
    animation_offsets_y=[0,0,0,0,0];
    animation_frame=0;
    for (x = 1; x < 6; x++) {
        create_animation_frame(animations[ANIMATION_TRI_END_LEFT], animation_frame, 150, "spock_tri_end_" + x, animation_offsets[animation_frame],animation_offsets_y[animation_frame]);
        animation_frame = animation_frame + 1;
    }

    animation_offsets=[-38,0,0,0,0];
    animation_offsets_y=[-2,0,0,0,0];
    animation_frame=0;
    for (x = 1; x < 4; x++) {
        create_animation_frame(animations[ANIMATION_PHASER_START_LEFT], animation_frame, 150, "spock_phaser_draw_" + x, animation_offsets[animation_frame],animation_offsets_y[animation_frame]);
        animation_frame = animation_frame + 1;
    }

    animation_offsets=[0,0,0];
    animation_offsets_y=[0,0,0];
    animation_frame=0;
    for (x = 3; x > 0; x--) {
        create_animation_frame(animations[ANIMATION_PHASER_END_LEFT], animation_frame, 150, "spock_phaser_draw_" + x, animation_offsets[animation_frame],animation_offsets_y[animation_frame]);
        animation_frame = animation_frame + 1;
    }
    create_animation_frame(animations[ANIMATION_PHASER_END_LEFT], animation_frame, 150, "spock_end_walk_3", 38,2);

    animation_offsets=[0,0,0,0,0];
    animation_offsets_y=[0,0,0,0,0];
    animation_frame=0;
    for (x = 1; x < 4; x++) {
        create_animation_frame(animations[ANIMATION_PHASER_CROUCH_LEFT], animation_frame, 550, "spock_phaser_crouch_fire_" + x, animation_offsets[animation_frame],animation_offsets_y[animation_frame]);
        animation_frame = animation_frame + 1;
    }
    animations[ANIMATION_PHASER_CROUCH_LEFT].list_of_animations_for_run[1].duration=2000;            


    rules = [];
    var spock = create_spock(animations,rules);
    var walk_left_init = (spock_to_init)=>{
        var animation_done = spock_to_init.current_animation_object.cur_frame==spock_to_init.current_animation_object.max_frame
        if(spock_to_init.x<50){
            spock_to_init.x = getRandomInt(500);
            spock_to_init.y = getRandomInt(500);
            spock_to_init.current_animation=ANIMATION_BEAM_IN
            spock_to_init.current_animation_object=deepCopyFunction(spock_to_init.animations[ANIMATION_BEAM_IN])
            return;
        }
    }
    var beam_out_init = (spock_to_init)=>{
        spock_to_init.x = getRandomInt(500);
        spock_to_init.y = getRandomInt(500);
    }
    var beam_out_walk_left_init = (spock_to_init)=>{
         // if(spock_to_init.current_animation==ANIMATION_BEAM_OUT && animation_done){
        //     console.log("beam out done, going to walk!")
        spock_to_init.x=$( document ).width();
        //      return;
        // }
    }
    rules[ANIMATION_BEAM_IN]=[
        build_rule(ANIMATION_TURN_LEFT,0,(spock)=>{}),
        build_rule(ANIMATION_COM_LEFT,0,(spock)=>{}),

    ]
    rules[ANIMATION_COM_LEFT]=[
        build_rule(ANIMATION_COM_END_LEFT,0,(spock)=>{}),                
    ]
    rules[ANIMATION_COM_END_LEFT]=[
        build_rule(ANIMATION_BEAM_OUT,0,(spock)=>{}),                
    ]
    rules[ANIMATION_BEAM_OUT]=[
        build_rule(ANIMATION_BEAM_IN,0,beam_out_init),
        build_rule(ANIMATION_WALK_LEFT_START,0,beam_out_walk_left_init),                
    ]
    rules[ANIMATION_TURN_LEFT]=[
        //build_rule(ANIMATION_PHASER_START_LEFT,0,(spock)=>{}),
        //build_rule(ANIMATION_WALK_LEFT_START,0,(spock)=>{}),
        //build_rule(ANIMATION_TRI_START_LEFT,0,(spock)=>{}),
        build_rule(ANIMATION_RETURN_TO_STANDING,0,(spock)=>{})
    ]
    rules[ANIMATION_RETURN_TO_STANDING]=[
        build_rule(ANIMATION_BEAM_OUT,0,(spock)=>{})
    ]

    rules[ANIMATION_PHASER_START_LEFT]=[
        //build_rule(ANIMATION_WALK_LEFT_START,0,(spock)=>{}),
        //build_rule(ANIMATION_TRI_START_LEFT,0,(spock)=>{}),
        build_rule(ANIMATION_PHASER_CROUCH_LEFT,3,(spock)=>{})
    ]

    rules[ANIMATION_PHASER_CROUCH_LEFT]=[
        build_rule(ANIMATION_PHASER_END_LEFT,0,(spock)=>{})
    ]

    rules[ANIMATION_PHASER_END_LEFT]=[
        build_rule(ANIMATION_TURN_LEFT,0,(spock)=>{}),
        build_rule(ANIMATION_COM_LEFT,0,(spock)=>{}),
        build_rule(ANIMATION_BEAM_OUT,0,(spock)=>{})
    ]

    rules[ANIMATION_TRI_START_LEFT]=[
        build_rule(ANIMATION_TRI_LEFT,10,(spock)=>{})
    ]

    rules[ANIMATION_TRI_END_LEFT]=[
        build_rule(ANIMATION_TURN_LEFT,0,(spock)=>{}),
        build_rule(ANIMATION_BEAM_OUT,0,(spock)=>{}),                
    ]


    rules[ANIMATION_TRI_LEFT]=[
        build_rule(ANIMATION_TRI_ADJUST_LEFT,0,(spock)=>{}),
        build_rule(ANIMATION_TRI_END_LEFT,0,(spock)=>{})

    ]

    rules[ANIMATION_TRI_ADJUST_LEFT]=[
        build_rule(ANIMATION_TRI_LEFT,0,(spock)=>{})
    ]

    rules[ANIMATION_WALK_LEFT_START]=[
        build_rule(ANIMATION_WALK_LEFT,10,(spock)=>{})
    ]
    rules[ANIMATION_WALK_LEFT]=[
        build_rule(ANIMATION_WALK_END,0,(spock)=>{}),
    ]
    rules[ANIMATION_WALK_END]=[
        build_rule(ANIMATION_TURN_LEFT,0,(spock)=>{}),
        build_rule(ANIMATION_COM_LEFT,0,(spock)=>{}),
    ]

    animation_loop(spock,true);
    // var width = 50;
    // $("#phaser_beam").css("width",width.toString()+"px");
    // var sinSide = Math.sin((85*Math.PI)/180)
    // var result = (width/sinSide) * Math.sin((5*Math.PI)/180)
    // var sinSide2 = Math.sin((90*Math.PI)/180)
    // var result2 = (width/sinSide2) * Math.sin((80*Math.PI)/180)
    // console.log(result2);
    // var phaser_tip_top_location = 398 + 17;
    // var phaser_tip_left_location = 362 + 6;
    // $("#phaser_beam").css("height","2px");
    // // $("#phaser_beam").css("top",(398+8).toString()+"px");
    // // $("#phaser_beam").css("left",(362-94).toString()+"px");      
    // $("#phaser_beam").css("top",(phaser_tip_top_location-result).toString()+"px");
    // $("#phaser_beam").css("left",(phaser_tip_left_location-result2).toString()+"px");            


})


// $(document).ready(function (){
//     $("#spock_start_walk_1").css("visibility","visible")
// })


